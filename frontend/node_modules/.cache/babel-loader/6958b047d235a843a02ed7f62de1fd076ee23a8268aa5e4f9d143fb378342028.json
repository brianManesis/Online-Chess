{"ast":null,"code":"import { PlayerColor } from \"../../utils/Constants\";\nimport { PieceModel } from \"./PieceModel\";\nexport class PawnModel extends PieceModel {\n  constructor(type, color) {\n    super(type, color);\n  }\n  validMove(boardModel, startSquare, endSquare, playerColor) {\n    const pos = endSquare.getPos();\n    return this.updatePossibleMoves(boardModel, startSquare, playerColor).has(pos);\n  }\n  updatePossibleMoves(boardModel, square, playerColor) {\n    const pawn = square.getPiece();\n    this.possibleMoves.clear();\n    if (pawn) {\n      const board = boardModel.getChessBoard();\n      const pieceDirections = this.pawnDirections(pawn.getColor());\n      const chessNotation = square.getPos();\n      const posArray = boardModel.posToArrayPos(chessNotation);\n      if (posArray) {\n        let fowardI = posArray.i + pieceDirections.dy;\n        let fowardJ = posArray.j + pieceDirections.dx;\n        if (this.withinBoard(fowardI, fowardJ)) {\n          let forwardSquare = board[fowardI][fowardJ];\n          let forwardSquarePiece = forwardSquare.getPiece();\n          if (forwardSquarePiece === undefined) {\n            this.possibleMoves.add(forwardSquare.getPos());\n          }\n          if (!pawn.beenMoved && forwardSquarePiece === undefined) {\n            let fowardI = posArray.i + 2 * pieceDirections.dy;\n            let fowardJ = posArray.j + 2 * pieceDirections.dx;\n            if (this.withinBoard(fowardI, fowardJ)) {\n              let forwardSquare = board[fowardI][fowardJ];\n              let forwardSquarePiece = forwardSquare.getPiece();\n              if (forwardSquarePiece === undefined) {\n                this.possibleMoves.add(forwardSquare.getPos());\n              }\n            }\n          }\n        }\n        let leftTakes = pieceDirections.takes.left;\n        let leftI = posArray.i + leftTakes.dy;\n        let leftJ = posArray.j + leftTakes.dx;\n        if (this.withinBoard(leftI, leftJ)) {\n          let leftSquare = board[leftI][leftJ];\n          let leftSquarePiece = leftSquare.getPiece();\n          if (leftSquarePiece && leftSquarePiece.getColor() !== playerColor) {\n            this.possibleMoves.add(leftSquare.getPos());\n          }\n        }\n        let rightTakes = pieceDirections.takes.right;\n        let rightI = posArray.i + rightTakes.dy;\n        let rightJ = posArray.j + rightTakes.dx;\n        if (this.withinBoard(rightI, rightJ)) {\n          let rightSquare = board[rightI][rightJ];\n          let rightSquarePiece = rightSquare.getPiece();\n          if (rightSquarePiece && rightSquarePiece.getColor() !== playerColor) {\n            this.possibleMoves.add(rightSquare.getPos());\n          }\n        }\n      }\n    }\n    return this.possibleMoves;\n  }\n  enPassant(boardModel, pos, playerColor, boardirections) {\n    const board = boardModel.getChessBoard();\n    const lastMove = boardModel.getMoveList().slice(-1)[0];\n    const pieceLastMovedNewPos = boardModel.posToArrayPos(lastMove.toSquare);\n    const pieceLastMovedOldPos = boardModel.posToArrayPos(lastMove.fromSquare);\n    if (!pieceLastMovedNewPos || !pieceLastMovedOldPos) return;\n    const pieceLastMoved = board[pieceLastMovedNewPos.i][pieceLastMovedNewPos.j];\n    if (!this.withinBoard(pos.i, pos.j + 1)) return;\n    let pieceLeft = board[pos.i][pos.j + 1];\n    let pieceRight = board[pos.i][pos.j - 1];\n    let pieceLastMovedDx = Math.abs(pieceLastMovedNewPos.j - pieceLastMovedOldPos.j);\n    let pieceLastMovedDy = Math.abs(pieceLastMovedNewPos.i - pieceLastMovedOldPos.i);\n    if (pieceLastMoved == pieceLeft && pieceLastMovedDx === 0 && pieceLastMovedDy === 2) {}\n  }\n  queening() {}\n  static pawnDirections(playerColor) {\n    return playerColor === PlayerColor.WHITE ? {\n      dx: 0,\n      dy: -1,\n      takes: {\n        left: {\n          dx: -1,\n          dy: -1\n        },\n        right: {\n          dx: 1,\n          dy: -1\n        }\n      }\n    } : {\n      dx: 0,\n      dy: 1,\n      takes: {\n        left: {\n          dx: -1,\n          dy: 1\n        },\n        right: {\n          dx: 1,\n          dy: 1\n        }\n      }\n    };\n  }\n}","map":{"version":3,"names":["PlayerColor","PieceModel","PawnModel","constructor","type","color","validMove","boardModel","startSquare","endSquare","playerColor","pos","getPos","updatePossibleMoves","has","square","pawn","getPiece","possibleMoves","clear","board","getChessBoard","pieceDirections","pawnDirections","getColor","chessNotation","posArray","posToArrayPos","fowardI","i","dy","fowardJ","j","dx","withinBoard","forwardSquare","forwardSquarePiece","undefined","add","beenMoved","leftTakes","takes","left","leftI","leftJ","leftSquare","leftSquarePiece","rightTakes","right","rightI","rightJ","rightSquare","rightSquarePiece","enPassant","boardirections","lastMove","getMoveList","slice","pieceLastMovedNewPos","toSquare","pieceLastMovedOldPos","fromSquare","pieceLastMoved","pieceLeft","pieceRight","pieceLastMovedDx","Math","abs","pieceLastMovedDy","queening","WHITE"],"sources":["/home/brian/Desktop/Projects/Chess/frontend/src/model/pieces/PawnModel.ts"],"sourcesContent":["import { ChessBoardModel } from \"../ChessBoardModel\";\nimport { SquareModel } from \"../SquareModel\";\nimport { PlayerColor, PieceType } from \"../../utils/Constants\";\nimport { PieceModel } from \"./PieceModel\";\n\nexport class PawnModel extends PieceModel{\n    public constructor(type: PieceType, color: PlayerColor){\n        super(type, color);\n    }\n    public validMove(boardModel:ChessBoardModel, startSquare:SquareModel,\n                    endSquare:SquareModel, playerColor:PlayerColor): boolean {\n        const pos = endSquare.getPos();\n        return this.updatePossibleMoves(boardModel,startSquare,playerColor).has(pos);    \n    }\n\n    private updatePossibleMoves(boardModel:ChessBoardModel, square:SquareModel, playerColor:PlayerColor):Set<string>{\n        const pawn = square.getPiece();\n        this.possibleMoves.clear();\n\n        if(pawn){\n            const board = boardModel.getChessBoard();\n            const pieceDirections = this.pawnDirections(pawn.getColor());\n            const chessNotation = square.getPos();\n            const posArray = boardModel.posToArrayPos(chessNotation);\n\n            if(posArray){\n                let fowardI = posArray.i+pieceDirections.dy;\n                let fowardJ = posArray.j+pieceDirections.dx;\n                if(this.withinBoard(fowardI,fowardJ)){\n                    let forwardSquare = board[fowardI][fowardJ];\n                    let forwardSquarePiece = forwardSquare.getPiece();\n                    if(forwardSquarePiece === undefined){\n                        this.possibleMoves.add(forwardSquare.getPos());\n                    }\n                    if(!pawn.beenMoved && forwardSquarePiece === undefined){\n                        let fowardI = posArray.i+2*pieceDirections.dy;\n                        let fowardJ = posArray.j+2*pieceDirections.dx;\n                        if(this.withinBoard(fowardI,fowardJ)){\n                            let forwardSquare = board[fowardI][fowardJ];\n                            let forwardSquarePiece = forwardSquare.getPiece();\n                            if(forwardSquarePiece === undefined){\n                                this.possibleMoves.add(forwardSquare.getPos());\n                            }\n                        }\n                    }\n                }\n                \n                let leftTakes = pieceDirections.takes.left;\n                let leftI = posArray.i+leftTakes.dy;\n                let leftJ = posArray.j+leftTakes.dx;\n                if(this.withinBoard(leftI,leftJ)){\n                    let leftSquare = board[leftI][leftJ];\n                    let leftSquarePiece = leftSquare.getPiece();\n                    if(leftSquarePiece && leftSquarePiece.getColor() !== playerColor){\n                        this.possibleMoves.add(leftSquare.getPos());\n                    }\n                }\n\n                let rightTakes = pieceDirections.takes.right;\n                let rightI = posArray.i+rightTakes.dy;\n                let rightJ = posArray.j+rightTakes.dx;\n                if(this.withinBoard(rightI,rightJ)){\n                    let rightSquare = board[rightI][rightJ];\n                    let rightSquarePiece = rightSquare.getPiece();\n                    if(rightSquarePiece && rightSquarePiece.getColor() !== playerColor){\n                        this.possibleMoves.add(rightSquare.getPos());\n                    }\n                }\n            }\n        }\n        return this.possibleMoves;\n    }\n\n    private enPassant(\n        boardModel:ChessBoardModel, \n        pos:{i:number,j:number}, \n        playerColor:PlayerColor,\n        boardirections:object\n        ){\n\n        const board = boardModel.getChessBoard();\n        const lastMove = boardModel.getMoveList().slice(-1)[0];\n        const pieceLastMovedNewPos = boardModel.posToArrayPos(lastMove.toSquare);\n        const pieceLastMovedOldPos = boardModel.posToArrayPos(lastMove.fromSquare)\n\n        if(!pieceLastMovedNewPos || !pieceLastMovedOldPos) return;\n        \n        const pieceLastMoved = board[pieceLastMovedNewPos.i][pieceLastMovedNewPos.j];\n\n        if(!this.withinBoard(pos.i,pos.j+1)) return;\n\n        let pieceLeft = board[pos.i][pos.j+1];\n        let pieceRight = board[pos.i][pos.j-1];\n        let pieceLastMovedDx = Math.abs(pieceLastMovedNewPos.j-pieceLastMovedOldPos.j);\n        let pieceLastMovedDy = Math.abs(pieceLastMovedNewPos.i-pieceLastMovedOldPos.i);\n        if(pieceLastMoved == pieceLeft && pieceLastMovedDx===0 && pieceLastMovedDy===2){\n            \n        }\n    }\n    private queening(){\n\n    }\n    \n    public static pawnDirections(playerColor:PlayerColor){\n        return playerColor === PlayerColor.WHITE?\n        {\n            dx: 0,\n            dy: -1,\n            takes: {\n                left:{\n                    dx: -1,\n                    dy: -1\n                },\n                right:{\n                    dx: 1,\n                    dy: -1\n                }\n            }\n        }:\n        {\n            dx: 0,\n            dy: 1,\n            takes: {\n                left:{\n                    dx: -1,\n                    dy: 1\n                },\n                right:{\n                    dx: 1,\n                    dy: 1\n                }\n            }\n        }\n    }\n    \n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}