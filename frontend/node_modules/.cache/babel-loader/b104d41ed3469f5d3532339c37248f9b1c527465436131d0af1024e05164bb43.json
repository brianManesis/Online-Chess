{"ast":null,"code":"import { PawnModel } from \"./pieces/PawnModel\";\nimport { RookModel } from \"./pieces/RookModel\";\nimport { KnightModel } from \"./pieces/KnightModel\";\nimport { BishopModel } from \"./pieces/BishopModel\";\nimport { QueenModel } from \"./pieces/QueenModel\";\nimport { KingModel } from \"./pieces/KingModel\";\nimport { SquareModel } from \"./SquareModel\";\nimport { ROW_VALUES, COL_VALUES, PlayerColor, PieceType, BOARD_SIZE } from \"../utils/Constants\";\nexport class ChessBoardModel {\n  constructor() {\n    this.chessBoard = void 0;\n    this.posMap = new Map();\n    this.moveList = [];\n    this.turn = void 0;\n    this.chessBoard = [[], [], [], [], [], [], [], []];\n    this.initBoard();\n    this.turn = PlayerColor.WHITE;\n  }\n  move(startPos, endPos) {\n    const fromSquare = this.getSquareByPos(startPos);\n    const toSquare = this.getSquareByPos(endPos);\n    if (fromSquare && toSquare) {\n      let pieceOnFromSquare = fromSquare.getPiece();\n      if (!pieceOnFromSquare) return false;\n      let pieceColor = pieceOnFromSquare.getColor();\n      if (pieceColor !== this.turn) return false;\n      if (this.castleMove(fromSquare, toSquare)) return true;\n      if (this.queeningMove(fromSquare, toSquare)) return true;\n      if (this.enPassant(fromSquare, toSquare)) return true;\n      if (!this.validMove(fromSquare, toSquare, pieceColor)) return false;\n      pieceOnFromSquare.beenMoved = true;\n      fromSquare.setPiece(undefined);\n      toSquare.setPiece(pieceOnFromSquare);\n      this.moveList.push({\n        fromSquare: fromSquare.getPos(),\n        toSquare: toSquare.getPos()\n      });\n      this.changeTurn();\n      return true;\n    }\n  }\n  validMove(startSquare, endSquare, playerColor) {\n    const pieceMove = startSquare.getPiece();\n    if (pieceMove && pieceMove.validMove(this, startSquare, endSquare, playerColor)) {\n      return true;\n    }\n    return false;\n  }\n  castleMove(startSquare, endSquare) {\n    const king = startSquare.getPiece();\n    let rookSquare = null;\n    let newRookSquare = null;\n    const endSquarePos = endSquare.getPos();\n    if (!king || king.getType() !== PieceType.KING) return false;\n    if (king.beenMoved) return false;\n    if (endSquarePos !== \"c1\" && endSquarePos !== \"g1\" && endSquarePos !== \"c8\" && endSquarePos !== \"g8\") return false;\n    const kingColor = king.getColor();\n    const row = kingColor === PlayerColor.WHITE ? 7 : 0;\n    if (endSquarePos.charAt(0) === \"g\") {\n      rookSquare = this.chessBoard[row][7];\n      if (this.chessBoard[row][6].getPiece() || king.kingInCheck(this, this.chessBoard[row][6].getPos()) || this.chessBoard[row][5].getPiece() || king.kingInCheck(this, this.chessBoard[row][5].getPos())) return false;\n      newRookSquare = this.chessBoard[row][5];\n    } else {\n      rookSquare = this.chessBoard[row][0];\n      if (this.chessBoard[row][3].getPiece() || king.kingInCheck(this, this.chessBoard[row][3].getPos()) || this.chessBoard[row][2].getPiece() || king.kingInCheck(this, this.chessBoard[row][2].getPos()) || this.chessBoard[row][1].getPiece() || king.kingInCheck(this, this.chessBoard[row][1].getPos())) return false;\n      newRookSquare = this.chessBoard[row][3];\n    }\n    const rook = rookSquare.getPiece();\n    if (!rook || rook.getType() !== PieceType.ROOK) return false;\n    if (rook.beenMoved) return false;\n    rookSquare.setPiece(undefined);\n    startSquare.setPiece(undefined);\n    newRookSquare.setPiece(rook);\n    endSquare.setPiece(king);\n    king.beenMoved = true;\n    rook.beenMoved = true;\n    this.moveList.push({\n      fromSquare: startSquare.getPos(),\n      toSquare: endSquare.getPos()\n    });\n    return true;\n  }\n  queeningMove(startSquare, endSquare) {\n    const pawn = startSquare.getPiece();\n    const endSquarePos = this.posToArrayPos(endSquare.getPos());\n    if (!pawn || pawn.getType() !== PieceType.PAWN) return false;\n    if (!endSquarePos) return false;\n    const pawnColor = pawn.getColor();\n    let endRow = pawnColor === PlayerColor.WHITE ? 0 : 7;\n    let endSquareRow = endSquarePos.i;\n    if (pawnColor === PlayerColor.WHITE && endSquareRow !== endRow) return false;else if (pawnColor === PlayerColor.BLACK && endSquareRow !== endRow) return false;\n    startSquare.setPiece(undefined);\n    endSquare.setPiece(new QueenModel(PieceType.QUEEN, pawnColor));\n    this.moveList.push({\n      fromSquare: startSquare.getPos(),\n      toSquare: endSquare.getPos()\n    });\n    return true;\n  }\n  enPassant(startSquare, endSquare) {\n    const board = this.chessBoard;\n    const pawn = startSquare.getPiece();\n    const startSquarePos = this.posToArrayPos(startSquare.getPos());\n    if (this.moveList.length === 0) return false;\n    const lastMove = this.getMoveList().slice(-1)[0];\n    const pieceLastMovedNewPos = this.posToArrayPos(lastMove.toSquare);\n    const pieceLastMovedOldPos = this.posToArrayPos(lastMove.fromSquare);\n    if (!pawn || pawn.getType() !== PieceType.PAWN) return false;\n    if (!startSquarePos) return false;\n    if (!pieceLastMovedNewPos || !pieceLastMovedOldPos) return false;\n    let direction = PawnModel.pawnDirections(pawn.getColor());\n    const pieceLastMoved = board[pieceLastMovedNewPos.i][pieceLastMovedNewPos.j];\n    let pieceLeft;\n    let pieceRight;\n    if (ChessBoardModel.withinBoard(startSquarePos.i, startSquarePos.j - 1)) {\n      pieceLeft = board[startSquarePos.i][startSquarePos.j - 1];\n    }\n    if (ChessBoardModel.withinBoard(startSquarePos.i, startSquarePos.j + 1)) {\n      pieceRight = board[startSquarePos.i][startSquarePos.j + 1];\n    }\n    let pieceLeftTakes = board[startSquarePos.i + direction.takes.left.dy][startSquarePos.j + direction.takes.left.dx];\n    let pieceRightTakes = board[startSquarePos.i + direction.takes.right.dy][startSquarePos.j + direction.takes.right.dx];\n    let pieceLastMovedDx = Math.abs(pieceLastMovedNewPos.j - pieceLastMovedOldPos.j);\n    let pieceLastMovedDy = Math.abs(pieceLastMovedNewPos.i - pieceLastMovedOldPos.i);\n    if (pieceLastMoved == pieceLeft && pieceLastMovedDx === 0 && pieceLastMovedDy === 2 && endSquare === pieceLeftTakes) {\n      startSquare.setPiece(undefined);\n      pieceLeft.setPiece(undefined);\n      pieceLeftTakes.setPiece(pawn);\n      this.moveList.push({\n        fromSquare: startSquare.getPos(),\n        toSquare: endSquare.getPos()\n      });\n      return true;\n    }\n    if (pieceLastMoved == pieceRight && pieceLastMovedDx === 0 && pieceLastMovedDy === 2 && endSquare === pieceRightTakes) {\n      startSquare.setPiece(undefined);\n      pieceRight.setPiece(undefined);\n      pieceRightTakes.setPiece(pawn);\n      this.moveList.push({\n        fromSquare: startSquare.getPos(),\n        toSquare: endSquare.getPos()\n      });\n      return true;\n    }\n    return false;\n  }\n  isKingInCheck(kingColor) {\n    const kingLocation = this.searchBoardForPiece(PieceType.KING, kingColor);\n    const kingPos = kingLocation.pos;\n    if (!kingPos) return false;\n    const king = kingLocation.piece;\n    if (!king) return false;\n    return king.kingInCheck(this, kingPos);\n  }\n  searchBoardForPiece(pieceType, pieceColor) {\n    for (let row of this.chessBoard) {\n      for (let square of row) {\n        const piece = square.getPiece();\n        if (piece && piece.getType() === pieceType && piece.getColor() === pieceColor) return {\n          pos: square.getPos(),\n          piece: piece\n        };\n      }\n    }\n    return {\n      pos: undefined,\n      piece: undefined\n    };\n  }\n  searchBoardFromPos(ignorePiece, startPos, directions, pieceType, callback) {\n    const board = this.getChessBoard();\n    const posArray = this.posToArrayPos(startPos);\n    if (!posArray) return false;\n    for (const [key, value] of Object.entries(directions)) {\n      let i = posArray.i;\n      let j = posArray.j;\n      let result = callback(board, ignorePiece, i, j, value, pieceType);\n      if (result) return true;\n    }\n    return false;\n  }\n  findPiece(board, ignorePiece, i, j, direction, pieceType) {\n    i += direction.dy;\n    j += direction.dx;\n    if (ChessBoardModel.withinBoard(i, j)) {\n      const currentPiece = board[i][j].getPiece();\n      if (currentPiece && currentPiece.getColor() !== ignorePiece.getColor()) {\n        if (currentPiece.getType() == pieceType) {\n          return true;\n        } else {\n          return false;\n        }\n      } else if (currentPiece && currentPiece.getColor() === ignorePiece.getColor() && currentPiece !== ignorePiece) {\n        return false;\n      }\n    }\n    return false;\n  }\n  findPieceInDirection(board, ignorePiece, i, j, direction, pieceType) {\n    let flag = true;\n    while (flag) {\n      i += direction.dy;\n      j += direction.dx;\n      if (ChessBoardModel.withinBoard(i, j)) {\n        const currentPiece = board[i][j].getPiece();\n        if (currentPiece && currentPiece.getColor() !== ignorePiece.getColor()) {\n          if (currentPiece.getType() == pieceType) {\n            return true;\n          } else {\n            flag = false;\n          }\n        } else if (currentPiece && currentPiece.getColor() === ignorePiece.getColor() && currentPiece !== ignorePiece) {\n          flag = false;\n        }\n      } else flag = false;\n    }\n    return false;\n  }\n  findPawnAttack(ignorePiece, kingPos) {\n    let pawnDirection = PawnModel.pawnDirections(ignorePiece.getColor());\n    const posArray = this.posToArrayPos(kingPos);\n    if (!posArray) return false;\n    let leftTakes = pawnDirection.takes.left;\n    let rightTakes = pawnDirection.takes.right;\n    return this.findPiece(this.chessBoard, ignorePiece, posArray.i, posArray.j, leftTakes, PieceType.PAWN) || this.findPiece(this.chessBoard, ignorePiece, posArray.i, posArray.j, rightTakes, PieceType.PAWN);\n  }\n  getChessBoard() {\n    return this.chessBoard;\n  }\n  getMoveList() {\n    return this.moveList;\n  }\n  getPosMap() {\n    return this.posMap;\n  }\n  posToArrayPos(pos) {\n    return this.posMap.get(pos);\n  }\n  getSquareByPos(pos) {\n    let arrayPos = this.posMap.get(pos);\n    if (!arrayPos) return null;\n    let iPos = arrayPos.i;\n    let jPos = arrayPos.j;\n    const square = this.chessBoard[iPos][jPos];\n    if (!square) return null;\n    return square;\n  }\n  static withinBoard(i, j) {\n    return i >= 0 && i < BOARD_SIZE && j >= 0 && j < BOARD_SIZE;\n  }\n  changeTurn() {\n    this.turn = this.turn === PlayerColor.WHITE ? PlayerColor.BLACK : PlayerColor.WHITE;\n  }\n  initBoard() {\n    let col = ROW_VALUES;\n    let row = [...COL_VALUES].reverse();\n    for (let i = 0; i < BOARD_SIZE; i++) {\n      for (let j = 0; j < BOARD_SIZE; j++) {\n        let pos = col[j] + row[i];\n        this.posMap.set(pos, {\n          i: i,\n          j: j\n        });\n        let color = (j + i + 2) % 2 == 0 ? PlayerColor.WHITE : PlayerColor.BLACK;\n        let piece = this.genPiece(col[j], row[i]);\n        if (piece) {\n          this.chessBoard[i].push(new SquareModel(color, pos, piece));\n        } else {\n          this.chessBoard[i].push(new SquareModel(color, pos));\n        }\n      }\n    }\n  }\n  genPiece(col, row) {\n    if (row == 2) {\n      return new PawnModel(PieceType.PAWN, PlayerColor.WHITE);\n    } else if (row == 7) {\n      return new PawnModel(PieceType.PAWN, PlayerColor.BLACK);\n    } else if (row == 1) {\n      if (col == 'a' || col == 'h') {\n        return new RookModel(PieceType.ROOK, PlayerColor.WHITE);\n      } else if (col == 'b' || col == 'g') {\n        return new KnightModel(PieceType.KNIGHT, PlayerColor.WHITE);\n      } else if (col == 'c' || col == 'f') {\n        return new BishopModel(PieceType.BISHOP, PlayerColor.WHITE);\n      } else if (col == 'd') {\n        return new QueenModel(PieceType.QUEEN, PlayerColor.WHITE);\n      } else {\n        return new KingModel(PieceType.KING, PlayerColor.WHITE);\n      }\n    } else if (row == 8) {\n      if (col == 'a' || col == 'h') {\n        return new RookModel(PieceType.ROOK, PlayerColor.BLACK);\n      } else if (col == 'b' || col == 'g') {\n        return new KnightModel(PieceType.KNIGHT, PlayerColor.BLACK);\n      } else if (col == 'c' || col == 'f') {\n        return new BishopModel(PieceType.BISHOP, PlayerColor.BLACK);\n      } else if (col == 'd') {\n        return new QueenModel(PieceType.QUEEN, PlayerColor.BLACK);\n      } else {\n        return new KingModel(PieceType.KING, PlayerColor.BLACK);\n      }\n    } else {\n      return undefined;\n    }\n  }\n  clone() {\n    const clone = Object.assign(Object.create(Object.getPrototypeOf(this)), this);\n    clone.chessBoard = this.chessBoard.map(row => row.map(square => {\n      const clonedSquare = new SquareModel(square.getColor(), square.getPos());\n      const piece = square.getPiece();\n      if (piece) {\n        const clonedPiece = Object.assign(Object.create(Object.getPrototypeOf(piece)), piece);\n        clonedSquare.setPiece(clonedPiece);\n      }\n      return clonedSquare;\n    }));\n    clone.posMap = new Map(this.posMap);\n    return clone;\n  }\n}","map":{"version":3,"names":["PawnModel","RookModel","KnightModel","BishopModel","QueenModel","KingModel","SquareModel","ROW_VALUES","COL_VALUES","PlayerColor","PieceType","BOARD_SIZE","ChessBoardModel","constructor","chessBoard","posMap","Map","moveList","turn","initBoard","WHITE","move","startPos","endPos","fromSquare","getSquareByPos","toSquare","pieceOnFromSquare","getPiece","pieceColor","getColor","castleMove","queeningMove","enPassant","validMove","beenMoved","setPiece","undefined","push","getPos","changeTurn","startSquare","endSquare","playerColor","pieceMove","king","rookSquare","newRookSquare","endSquarePos","getType","KING","kingColor","row","charAt","kingInCheck","rook","ROOK","pawn","posToArrayPos","PAWN","pawnColor","endRow","endSquareRow","i","BLACK","QUEEN","board","startSquarePos","length","lastMove","getMoveList","slice","pieceLastMovedNewPos","pieceLastMovedOldPos","direction","pawnDirections","pieceLastMoved","j","pieceLeft","pieceRight","withinBoard","pieceLeftTakes","takes","left","dy","dx","pieceRightTakes","right","pieceLastMovedDx","Math","abs","pieceLastMovedDy","isKingInCheck","kingLocation","searchBoardForPiece","kingPos","pos","piece","pieceType","square","searchBoardFromPos","ignorePiece","directions","callback","getChessBoard","posArray","key","value","Object","entries","result","findPiece","currentPiece","findPieceInDirection","flag","findPawnAttack","pawnDirection","leftTakes","rightTakes","getPosMap","get","arrayPos","iPos","jPos","col","reverse","set","color","genPiece","KNIGHT","BISHOP","clone","assign","create","getPrototypeOf","map","clonedSquare","clonedPiece"],"sources":["/home/brian/Desktop/Projects/Chess/frontend/src/model/ChessBoardModel.ts"],"sourcesContent":["import { PieceModel } from \"./pieces/PieceModel\";\nimport { PawnModel } from \"./pieces/PawnModel\";\nimport { RookModel } from \"./pieces/RookModel\";\nimport { KnightModel } from \"./pieces/KnightModel\";\nimport { BishopModel } from \"./pieces/BishopModel\";\nimport { QueenModel } from \"./pieces/QueenModel\";\nimport { KingModel } from \"./pieces/KingModel\";\nimport { SquareModel } from \"./SquareModel\";\nimport { ROW_VALUES, COL_VALUES, PlayerColor, PieceType, BOARD_SIZE} from \"../utils/Constants\";\n\nexport class ChessBoardModel{\n    private chessBoard: Array<Array<SquareModel>>;\n    private posMap:Map<string,{i:number,j:number}> = new Map();\n    private moveList:Array<{fromSquare:string, toSquare:string}>=[];\n    public turn:PlayerColor;\n\n    public constructor(){\n        this.chessBoard = [[],[],[],[],[],[],[],[]];\n        this.initBoard();\n        this.turn = PlayerColor.WHITE;\n    }\n\n    public move(startPos:string, endPos:string){\n        const fromSquare = this.getSquareByPos(startPos);\n        const toSquare = this.getSquareByPos(endPos);\n\n        if(fromSquare && toSquare){\n            let pieceOnFromSquare: PieceModel | undefined = fromSquare.getPiece();\n            if(!pieceOnFromSquare) return false;\n\n            let pieceColor = pieceOnFromSquare.getColor();\n            if(pieceColor !== this.turn) return false;\n            if(this.castleMove(fromSquare,toSquare)) return true;\n            if(this.queeningMove(fromSquare,toSquare)) return true;\n            if(this.enPassant(fromSquare,toSquare)) return true;\n            if(!this.validMove(fromSquare,toSquare,pieceColor)) return false;\n\n            pieceOnFromSquare.beenMoved = true;\n            fromSquare.setPiece(undefined);\n            toSquare.setPiece(pieceOnFromSquare);\n            this.moveList.push({fromSquare:fromSquare.getPos(),toSquare:toSquare.getPos()});\n            this.changeTurn();\n            return true;\n        }\n    }\n    \n    public validMove(startSquare:SquareModel, endSquare:SquareModel, playerColor:PlayerColor){\n        const pieceMove = startSquare.getPiece();\n        if(pieceMove &&\n           pieceMove.validMove(this,startSquare,endSquare,playerColor)){\n           return true;\n        }\n        return false;\n    }\n\n    public castleMove(startSquare:SquareModel, endSquare:SquareModel){\n        const king = startSquare.getPiece() as KingModel;\n        let rookSquare = null;\n        let newRookSquare = null;\n        const endSquarePos = endSquare.getPos();\n\n        if(!king || king.getType() !== PieceType.KING) return false;\n        if(king.beenMoved) return false;\n        if( endSquarePos !== \"c1\" && endSquarePos !== \"g1\" &&\n            endSquarePos !== \"c8\" && endSquarePos !== \"g8\") return false;\n        const kingColor = king.getColor();\n        const row = kingColor === PlayerColor.WHITE? 7:0;\n\n        if(endSquarePos.charAt(0) === \"g\"){\n            rookSquare = this.chessBoard[row][7];\n            if( this.chessBoard[row][6].getPiece() || king.kingInCheck(this,this.chessBoard[row][6].getPos())||\n                this.chessBoard[row][5].getPiece() || king.kingInCheck(this,this.chessBoard[row][5].getPos())\n            ) return false;\n            newRookSquare = this.chessBoard[row][5];\n        }\n        else{\n            rookSquare = this.chessBoard[row][0]; \n            if( this.chessBoard[row][3].getPiece() || king.kingInCheck(this,this.chessBoard[row][3].getPos())||\n                this.chessBoard[row][2].getPiece() || king.kingInCheck(this,this.chessBoard[row][2].getPos())||\n                this.chessBoard[row][1].getPiece() || king.kingInCheck(this,this.chessBoard[row][1].getPos())\n            ) return false;\n            newRookSquare = this.chessBoard[row][3];\n        }\n        const rook = rookSquare.getPiece();\n        if(!rook || rook.getType() !== PieceType.ROOK) return false;\n        if(rook.beenMoved) return false;\n\n        rookSquare.setPiece(undefined);\n        startSquare.setPiece(undefined);\n        newRookSquare.setPiece(rook);\n        endSquare.setPiece(king);\n        king.beenMoved = true;\n        rook.beenMoved = true;\n        this.moveList.push({fromSquare:startSquare.getPos(),toSquare:endSquare.getPos()});\n        return true;\n    }\n    private queeningMove(startSquare:SquareModel, endSquare:SquareModel){\n        const pawn = startSquare.getPiece();\n        const endSquarePos = this.posToArrayPos(endSquare.getPos());\n        if(!pawn || pawn.getType() !== PieceType.PAWN) return false;\n        if(!endSquarePos) return false;\n        \n        const pawnColor = pawn.getColor();\n        let endRow = pawnColor === PlayerColor.WHITE? 0:7;\n        let endSquareRow = endSquarePos.i;\n        \n        if(pawnColor===PlayerColor.WHITE && endSquareRow!==endRow) return false;\n        else if(pawnColor===PlayerColor.BLACK && endSquareRow!==endRow) return false;\n\n        startSquare.setPiece(undefined);\n        endSquare.setPiece(new QueenModel(PieceType.QUEEN,pawnColor));\n        this.moveList.push({fromSquare:startSquare.getPos(),toSquare:endSquare.getPos()});\n        return true;\n    }\n    private enPassant(startSquare:SquareModel, endSquare:SquareModel){\n        const board = this.chessBoard;\n        const pawn = startSquare.getPiece();\n        const startSquarePos = this.posToArrayPos(startSquare.getPos());\n        if(this.moveList.length === 0) return false;\n\n        const lastMove = this.getMoveList().slice(-1)[0];\n        const pieceLastMovedNewPos = this.posToArrayPos(lastMove.toSquare);\n        const pieceLastMovedOldPos = this.posToArrayPos(lastMove.fromSquare);\n\n        if(!pawn || pawn.getType() !== PieceType.PAWN) return false;\n        if(!startSquarePos) return false;\n        if(!pieceLastMovedNewPos || !pieceLastMovedOldPos) return false;\n\n        let direction = PawnModel.pawnDirections(pawn.getColor());\n        \n        const pieceLastMoved = board[pieceLastMovedNewPos.i][pieceLastMovedNewPos.j];\n\n        let pieceLeft;\n        let pieceRight;\n        if(ChessBoardModel.withinBoard(startSquarePos.i,startSquarePos.j-1)){\n            pieceLeft = board[startSquarePos.i][startSquarePos.j-1];\n        }\n        if(ChessBoardModel.withinBoard(startSquarePos.i,startSquarePos.j+1)){\n            pieceRight = board[startSquarePos.i][startSquarePos.j+1];\n        }\n        let pieceLeftTakes = board[startSquarePos.i+direction.takes.left.dy][startSquarePos.j+direction.takes.left.dx];\n        let pieceRightTakes = board[startSquarePos.i+direction.takes.right.dy][startSquarePos.j+direction.takes.right.dx];\n        let pieceLastMovedDx = Math.abs(pieceLastMovedNewPos.j-pieceLastMovedOldPos.j);\n        let pieceLastMovedDy = Math.abs(pieceLastMovedNewPos.i-pieceLastMovedOldPos.i);\n        if(pieceLastMoved == pieceLeft && pieceLastMovedDx===0 && pieceLastMovedDy===2 && endSquare === pieceLeftTakes){\n            startSquare.setPiece(undefined);\n            pieceLeft.setPiece(undefined);\n            pieceLeftTakes.setPiece(pawn);\n            this.moveList.push({fromSquare:startSquare.getPos(),toSquare:endSquare.getPos()});\n            return true;\n        }\n        if(pieceLastMoved == pieceRight && pieceLastMovedDx===0 && pieceLastMovedDy===2 && endSquare === pieceRightTakes){\n            startSquare.setPiece(undefined);\n            pieceRight.setPiece(undefined);\n            pieceRightTakes.setPiece(pawn);\n            this.moveList.push({fromSquare:startSquare.getPos(),toSquare:endSquare.getPos()});\n            return true;\n        }\n        return false;\n    }\n    public isKingInCheck(kingColor:PlayerColor): boolean {\n        const kingLocation = this.searchBoardForPiece(PieceType.KING, kingColor)\n        const kingPos = kingLocation.pos;\n        if(!kingPos) return false;\n\n        const king = kingLocation.piece as KingModel;\n        if(!king) return false;\n\n        return king.kingInCheck(this,kingPos);\n    }\n    public searchBoardForPiece(pieceType:PieceType,pieceColor:PlayerColor):{pos:string | undefined, piece:PieceModel | undefined}{\n        for(let row of this.chessBoard){\n            for(let square of row){\n                const piece = square.getPiece();\n                if(piece && \n                   piece.getType() === pieceType &&\n                   piece.getColor() === pieceColor\n                   ) return {pos: square.getPos(), piece: piece};\n            }\n        }\n        return {pos:undefined, piece:undefined};\n    }\n    public searchBoardFromPos(ignorePiece:PieceModel,startPos:string, directions:Object, pieceType:PieceType, callback:Function){\n        const board = this.getChessBoard();\n        const posArray = this.posToArrayPos(startPos);\n        if(!posArray) return false;\n\n        for(const [key,value] of Object.entries(directions)){\n            let i = posArray.i;\n            let j = posArray.j;\n\n            let result = callback(board,ignorePiece,i,j,value,pieceType);\n            if(result) return true;\n        }\n\n        return false;\n    }\n    public findPiece(board: Array<Array<SquareModel>>,ignorePiece:PieceModel,i:number,j:number,direction:{dx:number,dy:number}, pieceType:PieceType){\n        i += direction.dy;\n        j += direction.dx;\n        if(ChessBoardModel.withinBoard(i,j)){\n            const currentPiece = board[i][j].getPiece();\n            if(currentPiece && currentPiece.getColor() !== ignorePiece.getColor()){\n                if( currentPiece.getType() == pieceType ){\n                        return true;\n                }\n                else{\n                    return false;\n                }\n            }else if( currentPiece && \n                        currentPiece.getColor() === ignorePiece.getColor() &&\n                        currentPiece !== ignorePiece){\n                return false;\n            }\n        }\n        return false;\n    }\n    public findPieceInDirection(board: Array<Array<SquareModel>>,ignorePiece:PieceModel,i:number,j:number,direction:{dx:number,dy:number}, pieceType:PieceType){\n        let flag = true;\n        while(flag){\n            i += direction.dy;\n            j += direction.dx;\n\n\n            if(ChessBoardModel.withinBoard(i,j)){\n                const currentPiece = board[i][j].getPiece();\n                if(currentPiece && currentPiece.getColor() !== ignorePiece.getColor()){\n                    if( currentPiece.getType() == pieceType){\n                            return true;\n                    }\n                    else{\n                        flag = false;\n                    }\n                }else if( currentPiece && \n                            currentPiece.getColor() === ignorePiece.getColor() &&\n                            currentPiece !== ignorePiece){\n                    flag = false;\n                }\n            }\n            else flag = false;\n        }       \n        return false;  \n    }\n    public findPawnAttack(ignorePiece:PieceModel,kingPos:string){\n        let pawnDirection = PawnModel.pawnDirections(ignorePiece.getColor());\n        const posArray = this.posToArrayPos(kingPos);\n        if(!posArray) return false;\n        let leftTakes = pawnDirection.takes.left;\n        let rightTakes = pawnDirection.takes.right;\n\n        return this.findPiece(this.chessBoard,ignorePiece,posArray.i,posArray.j,leftTakes,PieceType.PAWN) ||\n               this.findPiece(this.chessBoard,ignorePiece,posArray.i,posArray.j,rightTakes,PieceType.PAWN)\n    }\n    public getChessBoard():Array<Array<SquareModel>>{\n        return this.chessBoard;\n    }\n    public getMoveList(){\n        return this.moveList;\n    }\n    public getPosMap():Map<string,{i:number,j:number}>{\n        return this.posMap;\n    }\n    public posToArrayPos(pos: string){\n        return this.posMap.get(pos);\n    }\n\n    public getSquareByPos(pos: string){\n        let arrayPos = this.posMap.get(pos);\n        if(!arrayPos) return null;\n\n        let iPos = arrayPos.i;\n        let jPos = arrayPos.j;\n        const square = this.chessBoard[iPos][jPos];\n        if(!square) return null;\n\n        return square;\n    }\n    public static withinBoard(i:number, j:number){\n        return i>=0 &&\n               i<BOARD_SIZE &&\n               j>=0 &&\n               j<BOARD_SIZE;\n    }\n    private changeTurn() {\n        this.turn = this.turn === PlayerColor.WHITE?\n            PlayerColor.BLACK:\n            PlayerColor.WHITE;\n    }\n\n    private initBoard(){\n        let col = ROW_VALUES;\n        let row = [...COL_VALUES].reverse();\n       \n        for(let i = 0; i< BOARD_SIZE; i++){\n            for(let j = 0; j< BOARD_SIZE; j++){\n\n                let pos:string = col[j]+row[i];\n                this.posMap.set(pos,{i:i, j:j});\n                let color = (j+i+2) % 2 == 0? PlayerColor.WHITE:PlayerColor.BLACK\n                let piece:PieceModel | undefined = this.genPiece(col[j],row[i]);\n                \n                if(piece){\n                    this.chessBoard[i].push(\n                        new SquareModel(color,pos,piece)\n                    );\n                }else{\n                    this.chessBoard[i].push(\n                        new SquareModel(color,pos)\n                    );\n                }\n            }\n        }\n    }\n    private genPiece(col:string,row:number): PieceModel | undefined{\n        if(row == 2){\n            return new PawnModel(PieceType.PAWN,PlayerColor.WHITE);\n        }\n        else if(row == 7){\n            return new PawnModel(PieceType.PAWN,PlayerColor.BLACK);\n        }\n        else if(row == 1){\n            if(col == 'a' || col == 'h'){\n                return new RookModel(PieceType.ROOK,PlayerColor.WHITE);\n            }\n            else if(col== 'b' || col == 'g'){\n                return new KnightModel(PieceType.KNIGHT, PlayerColor.WHITE);\n            }\n            else if(col== 'c' || col == 'f'){\n                return new BishopModel(PieceType.BISHOP, PlayerColor.WHITE);\n            }\n            else if(col == 'd'){\n                return new QueenModel(PieceType.QUEEN, PlayerColor.WHITE);\n            }\n            else{\n                return new KingModel(PieceType.KING, PlayerColor.WHITE);\n            }\n        }\n        else if(row == 8){\n            if(col == 'a' || col == 'h'){\n                return new RookModel(PieceType.ROOK,PlayerColor.BLACK);\n            }\n            else if(col== 'b' || col == 'g'){\n                return new KnightModel(PieceType.KNIGHT, PlayerColor.BLACK);\n            }\n            else if(col== 'c' || col == 'f'){\n                return new BishopModel(PieceType.BISHOP, PlayerColor.BLACK);\n            }\n            else if(col == 'd'){\n                return new QueenModel(PieceType.QUEEN, PlayerColor.BLACK);\n            }\n            else{\n                return new KingModel(PieceType.KING, PlayerColor.BLACK);\n            }\n        }\n        else{\n            return undefined;\n        }\n    }\n\n    public clone():ChessBoardModel{\n        const clone =Object.assign(Object.create(Object.getPrototypeOf(this)), this);\n        clone.chessBoard = this.chessBoard.map((row) =>\n            row.map((square) => {\n            const clonedSquare = new SquareModel(square.getColor(), square.getPos());\n            const piece = square.getPiece();\n            if (piece) {\n                const clonedPiece = Object.assign(Object.create(Object.getPrototypeOf(piece)), piece)\n                clonedSquare.setPiece(clonedPiece);\n            }\n            return clonedSquare;\n            })\n        );\n\n        clone.posMap = new Map(this.posMap);\n        return clone;\n    }\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}