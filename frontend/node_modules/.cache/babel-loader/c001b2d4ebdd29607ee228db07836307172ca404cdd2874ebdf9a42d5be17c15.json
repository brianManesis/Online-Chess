{"ast":null,"code":"import { PawnModel } from \"./pieces/PawnModel\";\nimport { RookModel } from \"./pieces/RookModel\";\nimport { KnightModel } from \"./pieces/KnightModel\";\nimport { BishopModel } from \"./pieces/BishopModel\";\nimport { QueenModel } from \"./pieces/QueenModel\";\nimport { KingModel } from \"./pieces/KingModel\";\nimport { SquareModel } from \"./SquareModel\";\nimport { ROW_VALUES, COL_VALUES, PlayerColor, PieceType, BOARD_SIZE } from \"../utils/Constants\";\nexport class ChessBoardModel {\n  constructor(playerColor) {\n    this.chessBoard = void 0;\n    this.playerColor = void 0;\n    this.posMap = new Map();\n    this.moveList = void 0;\n    this.playerColor = playerColor;\n    this.moveList = [];\n    let col = ROW_VALUES;\n    let row = [...COL_VALUES].reverse();\n    this.chessBoard = [[], [], [], [], [], [], [], []];\n    for (let i = 0; i < BOARD_SIZE; i++) {\n      for (let j = 0; j < BOARD_SIZE; j++) {\n        let pos = col[j] + row[i];\n        this.posMap.set(pos, {\n          i: i,\n          j: j\n        });\n        let color = (j + i + 2) % 2 == 0 ? PlayerColor.WHITE : PlayerColor.BLACK;\n        let piece = this.genPiece(col[j], row[i]);\n        if (piece) {\n          this.chessBoard[i].push(new SquareModel(color, pos, piece));\n        } else {\n          this.chessBoard[i].push(new SquareModel(color, pos));\n        }\n      }\n    }\n  }\n  getChessBoard() {\n    return this.chessBoard;\n  }\n  getMoveList() {\n    return this.moveList;\n  }\n  getPosMap() {\n    return this.posMap;\n  }\n  pieceMove(fromSquare, toSquare) {\n    if (fromSquare && toSquare) {\n      let pieceOnFromSquare = fromSquare.getPiece();\n      if (pieceOnFromSquare) {\n        let isCastleMove = this.isCastle(fromSquare, toSquare);\n        console.log(isCastleMove);\n        if (isCastleMove) return;\n        pieceOnFromSquare.beenMoved = true;\n        fromSquare.setPiece(undefined);\n        toSquare.setPiece(pieceOnFromSquare);\n      }\n    }\n  }\n  validMove(startSquare, endSquare, playerColor) {\n    const pieceMove = startSquare.getPiece();\n    if (pieceMove && pieceMove.validMove(this, startSquare, endSquare, playerColor)) {\n      return true;\n    }\n    return false;\n  }\n  isKingInCheck(kingColor) {\n    const kingLocation = this.searchBoardForPiece(PieceType.KING, kingColor);\n    const kingPos = kingLocation.pos;\n    if (!kingPos) return false;\n    const king = kingLocation.piece;\n    if (!king) return false;\n    return king.kingInCheck(this, kingPos);\n  }\n  isCastle(startSquare, endSquare) {\n    const king = startSquare.getPiece();\n    let rookSquare = null;\n    let newRookSquare = null;\n    const endSquarePos = endSquare.getPos();\n    if (!king || king.getType() !== PieceType.KING) return false;\n    if (king.beenMoved) return false;\n    if (endSquarePos !== \"c1\" && endSquarePos !== \"g1\") return false;\n    if (endSquarePos === \"g1\") {\n      rookSquare = this.chessBoard[7][7];\n      if (this.chessBoard[7][6].getPiece() || this.chessBoard[7][5].getPiece()) return false;\n      newRookSquare = this.chessBoard[7][5];\n    } else {\n      rookSquare = this.chessBoard[7][0];\n      if (this.chessBoard[7][3].getPiece() || this.chessBoard[7][2].getPiece() || this.chessBoard[7][1].getPiece()) return false;\n      newRookSquare = this.chessBoard[7][3];\n    }\n    const rook = rookSquare.getPiece();\n    if (!rook || rook.getType() !== PieceType.ROOK) return false;\n    if (rook.beenMoved) return false;\n    rookSquare.setPiece(undefined);\n    newRookSquare.setPiece(rook);\n    endSquare.setPiece(king);\n    return true;\n  }\n  searchBoardForPiece(pieceType, pieceColor) {\n    for (let row of this.chessBoard) {\n      for (let square of row) {\n        const piece = square.getPiece();\n        if (piece && piece.getType() === pieceType && piece.getColor() === pieceColor) return {\n          pos: square.getPos(),\n          piece: piece\n        };\n      }\n    }\n    return {\n      pos: undefined,\n      piece: undefined\n    };\n  }\n  searchBoardFromPos(ignorePiece, startPos, directions, pieceType, callback) {\n    const board = this.getChessBoard();\n    const posArray = this.posToArrayPos(startPos);\n    if (!posArray) return false;\n    for (const [key, value] of Object.entries(directions)) {\n      let i = posArray.i;\n      let j = posArray.j;\n      let result = callback(board, ignorePiece, i, j, value, pieceType);\n      if (result) return true;\n    }\n    return false;\n  }\n  findPiece(board, ignorePiece, i, j, direction, pieceType) {\n    i += direction.dy;\n    j += direction.dx;\n    if (ChessBoardModel.withinBoard(i, j)) {\n      const currentPiece = board[i][j].getPiece();\n      if (currentPiece && currentPiece.getColor() !== ignorePiece.getColor()) {\n        if (currentPiece.getType() == pieceType) {\n          return true;\n        } else {\n          return false;\n        }\n      } else if (currentPiece && currentPiece.getColor() === ignorePiece.getColor() && currentPiece !== ignorePiece) {\n        return false;\n      }\n    }\n    return false;\n  }\n  findPieceInDirection(board, ignorePiece, i, j, direction, pieceType) {\n    let flag = true;\n    while (flag) {\n      i += direction.dy;\n      j += direction.dx;\n      if (ChessBoardModel.withinBoard(i, j)) {\n        const currentPiece = board[i][j].getPiece();\n        if (currentPiece && currentPiece.getColor() !== ignorePiece.getColor()) {\n          if (currentPiece.getType() == pieceType) {\n            return true;\n          } else {\n            flag = false;\n          }\n        } else if (currentPiece && currentPiece.getColor() === ignorePiece.getColor() && currentPiece !== ignorePiece) {\n          flag = false;\n        }\n      } else flag = false;\n    }\n    return false;\n  }\n  findPawnAttack(ignorePiece, kingPos) {\n    let pawnDirection = PawnModel.pawnDirections(ignorePiece.getColor());\n    const posArray = this.posToArrayPos(kingPos);\n    if (!posArray) return false;\n    let leftTakes = pawnDirection.takes.left;\n    let rightTakes = pawnDirection.takes.right;\n    return this.findPiece(this.chessBoard, ignorePiece, posArray.i, posArray.j, leftTakes, PieceType.PAWN) || this.findPiece(this.chessBoard, ignorePiece, posArray.i, posArray.j, rightTakes, PieceType.PAWN);\n  }\n  posToArrayPos(pos) {\n    return this.posMap.get(pos);\n  }\n  getSquareByPos(pos) {\n    let arrayPos = this.posMap.get(pos);\n    if (!arrayPos) return null;\n    let iPos = arrayPos.i;\n    let jPos = arrayPos.j;\n    if (!iPos || !jPos) return null;\n    return this.chessBoard[iPos][jPos];\n  }\n  static withinBoard(i, j) {\n    return i >= 0 && i < BOARD_SIZE && j >= 0 && j < BOARD_SIZE;\n  }\n  genPiece(col, row) {\n    if (row == 2) {\n      return new PawnModel(PieceType.PAWN, PlayerColor.WHITE);\n    } else if (row == 7) {\n      return new PawnModel(PieceType.PAWN, PlayerColor.BLACK);\n    } else if (row == 1) {\n      if (col == 'a' || col == 'h') {\n        return new RookModel(PieceType.ROOK, PlayerColor.WHITE);\n      } else if (col == 'b' || col == 'g') {\n        return new KnightModel(PieceType.KNIGHT, PlayerColor.WHITE);\n      } else if (col == 'c' || col == 'f') {\n        return new BishopModel(PieceType.BISHOP, PlayerColor.WHITE);\n      } else if (col == 'd') {\n        return new QueenModel(PieceType.QUEEN, PlayerColor.WHITE);\n      } else {\n        return new KingModel(PieceType.KING, PlayerColor.WHITE);\n      }\n    } else if (row == 8) {\n      if (col == 'a' || col == 'h') {\n        return new RookModel(PieceType.ROOK, PlayerColor.BLACK);\n      } else if (col == 'b' || col == 'g') {\n        return new KnightModel(PieceType.KNIGHT, PlayerColor.BLACK);\n      } else if (col == 'c' || col == 'f') {\n        return new BishopModel(PieceType.BISHOP, PlayerColor.BLACK);\n      } else if (col == 'd') {\n        return new QueenModel(PieceType.QUEEN, PlayerColor.BLACK);\n      } else {\n        return new KingModel(PieceType.KING, PlayerColor.BLACK);\n      }\n    } else {\n      return undefined;\n    }\n  }\n  clone() {\n    const clone = new ChessBoardModel(this.playerColor);\n    clone.chessBoard = this.chessBoard.map(row => row.map(square => {\n      const clonedSquare = new SquareModel(square.getColor(), square.getPos());\n      const piece = square.getPiece();\n      if (piece) {\n        const clonedPiece = Object.assign(Object.create(Object.getPrototypeOf(piece)), piece);\n        clonedSquare.setPiece(clonedPiece);\n      }\n      return clonedSquare;\n    }));\n    clone.posMap = new Map(this.posMap);\n    return clone;\n  }\n}","map":{"version":3,"names":["PawnModel","RookModel","KnightModel","BishopModel","QueenModel","KingModel","SquareModel","ROW_VALUES","COL_VALUES","PlayerColor","PieceType","BOARD_SIZE","ChessBoardModel","constructor","playerColor","chessBoard","posMap","Map","moveList","col","row","reverse","i","j","pos","set","color","WHITE","BLACK","piece","genPiece","push","getChessBoard","getMoveList","getPosMap","pieceMove","fromSquare","toSquare","pieceOnFromSquare","getPiece","isCastleMove","isCastle","console","log","beenMoved","setPiece","undefined","validMove","startSquare","endSquare","isKingInCheck","kingColor","kingLocation","searchBoardForPiece","KING","kingPos","king","kingInCheck","rookSquare","newRookSquare","endSquarePos","getPos","getType","rook","ROOK","pieceType","pieceColor","square","getColor","searchBoardFromPos","ignorePiece","startPos","directions","callback","board","posArray","posToArrayPos","key","value","Object","entries","result","findPiece","direction","dy","dx","withinBoard","currentPiece","findPieceInDirection","flag","findPawnAttack","pawnDirection","pawnDirections","leftTakes","takes","left","rightTakes","right","PAWN","get","getSquareByPos","arrayPos","iPos","jPos","KNIGHT","BISHOP","QUEEN","clone","map","clonedSquare","clonedPiece","assign","create","getPrototypeOf"],"sources":["/home/brian/Desktop/Projects/Chess/frontend/src/model/ChessBoardModel.ts"],"sourcesContent":["import { PieceModel } from \"./pieces/PieceModel\";\nimport { PawnModel } from \"./pieces/PawnModel\";\nimport { RookModel } from \"./pieces/RookModel\";\nimport { KnightModel } from \"./pieces/KnightModel\";\nimport { BishopModel } from \"./pieces/BishopModel\";\nimport { QueenModel } from \"./pieces/QueenModel\";\nimport { KingModel } from \"./pieces/KingModel\";\nimport { SquareModel } from \"./SquareModel\";\nimport { ROW_VALUES, COL_VALUES, PlayerColor, PieceType, BOARD_SIZE} from \"../utils/Constants\";\n\nexport class ChessBoardModel{\n    private chessBoard: Array<Array<SquareModel>>;\n    private playerColor:PlayerColor;\n    private posMap:Map<string,{i:number,j:number}> = new Map();\n    private moveList:Array<{fromSquare:string, toSquare:string}>;\n\n    public constructor(playerColor:PlayerColor){\n        this.playerColor = playerColor;\n        this.moveList = [];\n        let col = ROW_VALUES;\n        let row = [...COL_VALUES].reverse();\n       \n        this.chessBoard = [[],[],[],[],[],[],[],[]];\n        for(let i = 0; i< BOARD_SIZE; i++){\n            for(let j = 0; j< BOARD_SIZE; j++){\n\n                let pos:string = col[j]+row[i];\n                this.posMap.set(pos,{i:i, j:j});\n                let color = (j+i+2) % 2 == 0? PlayerColor.WHITE:PlayerColor.BLACK\n                let piece:PieceModel | undefined = this.genPiece(col[j],row[i]);\n                \n                if(piece){\n                    this.chessBoard[i].push(\n                        new SquareModel(color,pos,piece)\n                    );\n                }else{\n                    this.chessBoard[i].push(\n                        new SquareModel(color,pos)\n                    );\n                }\n            }\n        }\n    }\n\n    public getChessBoard():Array<Array<SquareModel>>{\n        return this.chessBoard;\n    }\n    public getMoveList(){\n        return this.moveList;\n    }\n    public getPosMap():Map<string,{i:number,j:number}>{\n        return this.posMap;\n    }\n    public pieceMove(fromSquare:SquareModel, toSquare:SquareModel){\n        if(fromSquare && toSquare){\n            let pieceOnFromSquare: PieceModel | undefined = fromSquare.getPiece();\n            if(pieceOnFromSquare){\n                let isCastleMove = this.isCastle(fromSquare,toSquare);\n                console.log(isCastleMove);\n\n                if(isCastleMove) return;\n                pieceOnFromSquare.beenMoved = true;\n                fromSquare.setPiece(undefined);\n                toSquare.setPiece(pieceOnFromSquare);\n            }\n        }\n    }\n    public validMove(startSquare:SquareModel, endSquare:SquareModel, playerColor:PlayerColor){\n        const pieceMove = startSquare.getPiece();\n        if(pieceMove &&\n           pieceMove.validMove(this,startSquare,endSquare,playerColor)){\n           return true;\n        }\n        return false;\n    }\n\n    public isKingInCheck(kingColor:PlayerColor): boolean {\n        const kingLocation = this.searchBoardForPiece(PieceType.KING, kingColor)\n        const kingPos = kingLocation.pos;\n        if(!kingPos) return false;\n\n        const king = kingLocation.piece as KingModel;\n        if(!king) return false;\n\n        return king.kingInCheck(this,kingPos);\n    }\n    public isCastle(startSquare:SquareModel, endSquare:SquareModel){\n        const king = startSquare.getPiece();\n        let rookSquare = null;\n        let newRookSquare = null;\n        const endSquarePos = endSquare.getPos();\n        if(!king || king.getType() !== PieceType.KING) return false;\n        if(king.beenMoved) return false;\n        if(endSquarePos !== \"c1\" && endSquarePos !== \"g1\") return false;\n\n        if(endSquarePos === \"g1\"){\n            rookSquare = this.chessBoard[7][7];\n            if( this.chessBoard[7][6].getPiece() ||\n                this.chessBoard[7][5].getPiece()\n            ) return false;\n            newRookSquare = this.chessBoard[7][5];\n        }\n        else{\n            rookSquare = this.chessBoard[7][0]; \n            if( this.chessBoard[7][3].getPiece() ||\n                this.chessBoard[7][2].getPiece() ||\n                this.chessBoard[7][1].getPiece()\n            ) return false;\n            newRookSquare = this.chessBoard[7][3];\n        }\n        const rook = rookSquare.getPiece();\n        if(!rook || rook.getType() !== PieceType.ROOK) return false;\n        if(rook.beenMoved) return false;\n\n        rookSquare.setPiece(undefined);\n        newRookSquare.setPiece(rook);\n        endSquare.setPiece(king);\n        return true;\n    }\n    public searchBoardForPiece(pieceType:PieceType,pieceColor:PlayerColor):{pos:string | undefined, piece:PieceModel | undefined}{\n        for(let row of this.chessBoard){\n            for(let square of row){\n                const piece = square.getPiece();\n                if(piece && \n                   piece.getType() === pieceType &&\n                   piece.getColor() === pieceColor\n                   ) return {pos: square.getPos(), piece: piece};\n            }\n        }\n        return {pos:undefined, piece:undefined};\n    }\n    public searchBoardFromPos(ignorePiece:PieceModel,startPos:string, directions:Object, pieceType:PieceType, callback:Function){\n        const board = this.getChessBoard();\n        const posArray = this.posToArrayPos(startPos);\n        if(!posArray) return false;\n\n        for(const [key,value] of Object.entries(directions)){\n            let i = posArray.i;\n            let j = posArray.j;\n\n            let result = callback(board,ignorePiece,i,j,value,pieceType);\n            if(result) return true;\n        }\n\n        return false;\n    }\n    public findPiece(board: Array<Array<SquareModel>>,ignorePiece:PieceModel,i:number,j:number,direction:{dx:number,dy:number}, pieceType:PieceType){\n        i += direction.dy;\n        j += direction.dx;\n        if(ChessBoardModel.withinBoard(i,j)){\n            const currentPiece = board[i][j].getPiece();\n            if(currentPiece && currentPiece.getColor() !== ignorePiece.getColor()){\n                if( currentPiece.getType() == pieceType ){\n                        return true;\n                }\n                else{\n                    return false;\n                }\n            }else if( currentPiece && \n                        currentPiece.getColor() === ignorePiece.getColor() &&\n                        currentPiece !== ignorePiece){\n                return false;\n            }\n        }\n        return false;\n    }\n    public findPieceInDirection(board: Array<Array<SquareModel>>,ignorePiece:PieceModel,i:number,j:number,direction:{dx:number,dy:number}, pieceType:PieceType){\n        let flag = true;\n        while(flag){\n            i += direction.dy;\n            j += direction.dx;\n\n\n            if(ChessBoardModel.withinBoard(i,j)){\n                const currentPiece = board[i][j].getPiece();\n                if(currentPiece && currentPiece.getColor() !== ignorePiece.getColor()){\n                    if( currentPiece.getType() == pieceType){\n                            return true;\n                    }\n                    else{\n                        flag = false;\n                    }\n                }else if( currentPiece && \n                            currentPiece.getColor() === ignorePiece.getColor() &&\n                            currentPiece !== ignorePiece){\n                    flag = false;\n                }\n            }\n            else flag = false;\n        }       \n        return false;  \n    }\n    public findPawnAttack(ignorePiece:PieceModel,kingPos:string){\n        let pawnDirection = PawnModel.pawnDirections(ignorePiece.getColor());\n        const posArray = this.posToArrayPos(kingPos);\n        if(!posArray) return false;\n        let leftTakes = pawnDirection.takes.left;\n        let rightTakes = pawnDirection.takes.right;\n\n        return this.findPiece(this.chessBoard,ignorePiece,posArray.i,posArray.j,leftTakes,PieceType.PAWN) ||\n               this.findPiece(this.chessBoard,ignorePiece,posArray.i,posArray.j,rightTakes,PieceType.PAWN)\n    }\n    public posToArrayPos(pos: string){\n        return this.posMap.get(pos);\n    }\n\n    public getSquareByPos(pos: string){\n        let arrayPos = this.posMap.get(pos);\n        if(!arrayPos) return null;\n\n        let iPos = arrayPos.i;\n        let jPos = arrayPos.j;\n\n        if(!iPos || !jPos) return null;\n\n        return this.chessBoard[iPos][jPos];\n    }\n    public static withinBoard(i:number, j:number){\n        return i>=0 &&\n               i<BOARD_SIZE &&\n               j>=0 &&\n               j<BOARD_SIZE;\n    }\n    private genPiece(col:string,row:number): PieceModel | undefined{\n        if(row == 2){\n            return new PawnModel(PieceType.PAWN,PlayerColor.WHITE);\n        }\n        else if(row == 7){\n            return new PawnModel(PieceType.PAWN,PlayerColor.BLACK);\n        }\n        else if(row == 1){\n            if(col == 'a' || col == 'h'){\n                return new RookModel(PieceType.ROOK,PlayerColor.WHITE);\n            }\n            else if(col== 'b' || col == 'g'){\n                return new KnightModel(PieceType.KNIGHT, PlayerColor.WHITE);\n            }\n            else if(col== 'c' || col == 'f'){\n                return new BishopModel(PieceType.BISHOP, PlayerColor.WHITE);\n            }\n            else if(col == 'd'){\n                return new QueenModel(PieceType.QUEEN, PlayerColor.WHITE);\n            }\n            else{\n                return new KingModel(PieceType.KING, PlayerColor.WHITE);\n            }\n        }\n        else if(row == 8){\n            if(col == 'a' || col == 'h'){\n                return new RookModel(PieceType.ROOK,PlayerColor.BLACK);\n            }\n            else if(col== 'b' || col == 'g'){\n                return new KnightModel(PieceType.KNIGHT, PlayerColor.BLACK);\n            }\n            else if(col== 'c' || col == 'f'){\n                return new BishopModel(PieceType.BISHOP, PlayerColor.BLACK);\n            }\n            else if(col == 'd'){\n                return new QueenModel(PieceType.QUEEN, PlayerColor.BLACK);\n            }\n            else{\n                return new KingModel(PieceType.KING, PlayerColor.BLACK);\n            }\n        }\n        else{\n            return undefined;\n        }\n    }\n\n    public clone():ChessBoardModel{\n        const clone = new ChessBoardModel(this.playerColor);\n\n        clone.chessBoard = this.chessBoard.map((row) =>\n            row.map((square) => {\n            const clonedSquare = new SquareModel(square.getColor(), square.getPos());\n            const piece = square.getPiece();\n            if (piece) {\n                const clonedPiece = Object.assign(Object.create(Object.getPrototypeOf(piece)), piece)\n                clonedSquare.setPiece(clonedPiece);\n            }\n            return clonedSquare;\n            })\n        );\n\n        clone.posMap = new Map(this.posMap);\n        return clone;\n    }\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}